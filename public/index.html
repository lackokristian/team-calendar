<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Time‑Off Calendar</title>

    <!-- Tailwind & Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind custom palette -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        vacation: '#4ade80',
                        sick:     '#f87171',
                        other:    '#60a5fa',
                    }
                }
            }
        }
    </script>

    <style>
        /* ─────────────────────────  CALENDAR CELLS  ───────────────────────── */
        .calendar-day {
            height: 100px;
            overflow: visible;          /* allow tooltips to overflow */
            position: relative;         /* context for absolutely‑positioned kids (if ever needed) */
        }
        .calendar-day:hover {
            background-color: #f3f4f6;
        }

        /* ─────────────────────────  DOT + TOOLTIP  ───────────────────────── */
        .event-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 2px;
        }

        .tooltip {
            position: relative;   /* tooltiptext is absolute to this wrapper */
            display: inline-block;
        }

        .tooltip .tooltiptext {
            /* hidden by default */
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;

            /* aesthetic */
            background-color: #ffffff; /* solid white */
            color: #333333;
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            white-space: nowrap;
            min-width: 120px;

            /* positioning */
            position: absolute;
            bottom: 125%;          /* show above dot */
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* optional little arrow */
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;             /* at bottom edge of tooltip */
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: #ffffff transparent transparent transparent; /* white arrow */
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
        }

        /* ─────────────────────────  RESPONSIVE  ───────────────────────── */
        @media (max-width: 768px) {
            .calendar-day { height: 60px; font-size: 0.8rem; }
            .event-dot    { width: 6px;  height: 6px;  }
        }
    </style>
</head>

<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <!-- ───────────────────────── Header ───────────────────────── -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Team Time‑Off Calendar</h1>
            <p class="text-gray-600">Track and manage your team's time off in one place</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- ───────────────────────── Team members panel ───────────────────────── -->
            <div class="bg-white rounded-lg shadow p-6 lg:col-span-1">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Team Members</h2>
                    <button id="addMemberBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                        <i class="fas fa-plus mr-1"></i> Add
                    </button>
                </div>
                <div id="memberList" class="space-y-2"></div>

                <!-- add‑member modal -->
                <div id="addMemberModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg p-6 w-full max-w-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Add New Team Member</h3>
                            <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label for="memberName" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                <input type="text" id="memberName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="flex justify-end space-x-3">
                                <button id="cancelAddMemberBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Cancel</button>
                                <button id="saveMemberBtn" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ───────────────────────── Calendar panel ───────────────────────── -->
            <div class="bg-white rounded-lg shadow p-6 lg:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Time‑Off Calendar</h2>
                    <div class="flex space-x-2">
                        <button id="prevMonthBtn" class="p-2 rounded-full hover:bg-gray-100"><i class="fas fa-chevron-left"></i></button>
                        <button id="nextMonthBtn" class="p-2 rounded-full hover:bg-gray-100"><i class="fas fa-chevron-right"></i></button>
                        <button id="todayBtn" class="px-3 py-1 bg-gray-200 rounded-md text-sm hover:bg-gray-300">Today</button>
                        <button id="addTimeOffBtn" class="px-3 py-1 bg-green-500 text-white rounded-md text-sm hover:bg-green-600"><i class="fas fa-plus mr-1"></i> Add Time Off</button>
                    </div>
                </div>

                <div class="text-center mb-4"><h3 id="currentMonthYear" class="text-xl font-semibold text-gray-800"></h3></div>

                <!-- legend -->
                <div class="flex flex-wrap gap-3 mb-4">
                    <div class="flex items-center"><div class="w-3 h-3 rounded-full bg-vacation mr-1"></div><span class="text-xs">Vacation</span></div>
                    <div class="flex items-center"><div class="w-3 h-3 rounded-full bg-sick mr-1"></div><span class="text-xs">Sick Leave</span></div>
                    <div class="flex items-center"><div class="w-3 h-3 rounded-full bg-other mr-1"></div><span class="text-xs">Other</span></div>
                </div>

                <!-- calendar grid -->
                <div id="calendar" class="grid grid-cols-7 gap-1">
                    <div class="text-center font-medium text-gray-500 py-2">Sun</div>
                    <div class="text-center font-medium text-gray-500 py-2">Mon</div>
                    <div class="text-center font-medium text-gray-500 py-2">Tue</div>
                    <div class="text-center font-medium text-gray-500 py-2">Wed</div>
                    <div class="text-center font-medium text-gray-500 py-2">Thu</div>
                    <div class="text-center font-medium text-gray-500 py-2">Fri</div>
                    <div class="text-center font-medium text-gray-500 py-2">Sat</div>
                </div>

                <!-- add‑time‑off modal -->
                <div id="timeOffModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg p-6 w-full max-w-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Add Time Off</h3>
                            <button id="closeTimeOffModalBtn" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label for="timeOffMember" class="block text-sm font-medium text-gray-700 mb-1">Team Member</label>
                                <select id="timeOffMember" class="w-full px-3 py-2 border border-gray-300 rounded-md"></select>
                            </div>
                            <div>
                                <label for="timeOffType" class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <select id="timeOffType" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                    <option value="vacation">Vacation</option>
                                    <option value="sick">Sick Leave</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="timeOffStart" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                                    <input type="date" id="timeOffStart" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label for="timeOffEnd" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                                    <input type="date" id="timeOffEnd" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                            </div>
                            <div>
                                <label for="timeOffNotes" class="block text-sm font-medium text-gray-700 mb-1">Notes (Optional)</label>
                                <textarea id="timeOffNotes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                            </div>
                            <div class="flex justify-end space-x-3">
                                <button id="cancelTimeOffBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Cancel</button>
                                <button id="saveTimeOffBtn" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- /calendar panel -->
        </div> <!-- /grid -->

        <!-- ───────────────────────── Annual summary ───────────────────────── -->
        <div class="bg-white rounded-lg shadow p-6 mt-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Annual Time‑Off Summary</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase">Member</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase">Vacation</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase">Sick</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase">Other</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase">Total</th>
                        </tr>
                    </thead>
                    <tbody id="timeOffSummaryBody" class="divide-y divide-gray-200"></tbody>
                </table>
            </div>
        </div>

        <!-- ───────────────────────── All entries w/ month filter ───────────────────────── -->
        <div class="bg-white rounded-lg shadow p-6 mt-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800">All Time‑Off Entries</h2>
                <select id="monthFilter" class="border border-gray-300 rounded px-2 py-1 text-sm">
                    <option value="all">All Months</option>
                </select>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase">Member</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase">Type</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase">Dates</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase">Duration</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase">Notes</th>
                            <th class="px-6 py-3 text-left font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="timeOffTableBody" class="divide-y divide-gray-200"></tbody>
                </table>
            </div>
        </div>
    </div> <!-- /container -->

    <!-- ───────────────────────── JavaScript ───────────────────────── -->
    <script>
    /* ------------------------------------------------------------------
       Global state
    ------------------------------------------------------------------ */
    let teamMembers = [];
    let timeOffEntries = [];
    let currentDate    = new Date();

    /* ------------------------------------------------------------------
       DOM handles
    ------------------------------------------------------------------ */
    const memberList            = document.getElementById('memberList');
    const addMemberBtn          = document.getElementById('addMemberBtn');
    const addMemberModal        = document.getElementById('addMemberModal');
    const closeModalBtn         = document.getElementById('closeModalBtn');
    const cancelAddMemberBtn    = document.getElementById('cancelAddMemberBtn');
    const saveMemberBtn         = document.getElementById('saveMemberBtn');
    const memberNameInput       = document.getElementById('memberName');

    const calendar              = document.getElementById('calendar');
    const currentMonthYear      = document.getElementById('currentMonthYear');
    const prevMonthBtn          = document.getElementById('prevMonthBtn');
    const nextMonthBtn          = document.getElementById('nextMonthBtn');
    const todayBtn              = document.getElementById('todayBtn');
    const addTimeOffBtn         = document.getElementById('addTimeOffBtn');

    const timeOffModal          = document.getElementById('timeOffModal');
    const closeTimeOffModalBtn  = document.getElementById('closeTimeOffModalBtn');
    const cancelTimeOffBtn      = document.getElementById('cancelTimeOffBtn');
    const saveTimeOffBtn        = document.getElementById('saveTimeOffBtn');
    const timeOffMemberSelect   = document.getElementById('timeOffMember');
    const timeOffTypeSelect     = document.getElementById('timeOffType');
    const timeOffStartInput     = document.getElementById('timeOffStart');
    const timeOffEndInput       = document.getElementById('timeOffEnd');
    const timeOffNotesInput     = document.getElementById('timeOffNotes');

    const timeOffTableBody      = document.getElementById('timeOffTableBody');
    const timeOffSummaryBody    = document.getElementById('timeOffSummaryBody');
    const monthFilterSelect     = document.getElementById('monthFilter');

    /* ------------------------------------------------------------------
       Fetch helpers
    ------------------------------------------------------------------ */
    async function fetchData() {
        try {
            const [mRes, tRes] = await Promise.all([
                fetch('/api/members'),
                fetch('/api/timeoff')
            ]);
            teamMembers   = await mRes.json();
            timeOffEntries = await tRes.json();
        } catch (err) {
            console.error('Failed to fetch initial data', err);
            alert('Could not load data from the server. Is the server running?');
        }
    }

    /* ------------------------------------------------------------------
       Rendering helpers
    ------------------------------------------------------------------ */
    function renderTeamMembers() {
        memberList.innerHTML = '';
        teamMembers.forEach(m => {
            const el = document.createElement('div');
            el.className = 'flex justify-between items-center p-2 bg-gray-50 rounded';
            el.innerHTML = `
                <p class="font-medium">${m.name}</p>
                <button class="delete-member text-red-500 hover:text-red-700 p-1" data-id="${m.id}"><i class="fas fa-trash-alt"></i></button>`;
            memberList.appendChild(el);
        });
        // re‑bind delete buttons
        document.querySelectorAll('.delete-member').forEach(btn => btn.addEventListener('click', () => deleteMember(btn.dataset.id)));
    }

    function renderCalendar() {
        /* update month title */
        const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
        currentMonthYear.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

        /* clear old day cells but keep weekday headers (first 7 children) */
        while (calendar.children.length > 7) calendar.removeChild(calendar.lastChild);

        const firstDay   = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
        const lastDay    = new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 0);
        const daysInMonth= lastDay.getDate();
        const startWeekday = firstDay.getDay();

        /* leading blanks */
        for (let i=0;i<startWeekday;i++) calendar.appendChild(document.createElement('div')).className='calendar-day bg-gray-100';

        /* one cell per day */
        for (let d=1; d<=daysInMonth; d++) {
            const dayCell = document.createElement('div');
            dayCell.className = 'calendar-day border border-gray-200 p-1';

            const dayNumber = document.createElement('div');
            dayNumber.className = 'text-right font-medium text-sm';
            dayNumber.textContent = d;
            dayCell.appendChild(dayNumber);

            const dayDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), d);
            dayDate.setHours(0,0,0,0);

            /* find entries for this day */
            const todaysEntries = timeOffEntries.filter(e => {
                const s = new Date(e.startDate); s.setHours(0,0,0,0);
                const eDate = new Date(e.endDate); eDate.setHours(0,0,0,0);
                return dayDate >= s && dayDate <= eDate;
            });

            if (todaysEntries.length) {
                const dotsContainer = document.createElement('div');
                dotsContainer.className = 'mt-1 flex flex-wrap gap-1';

                todaysEntries.forEach(entry => {
                    const member = teamMembers.find(m=>m.id===entry.memberId);
                    if (!member) return;
                    const tooltip = document.createElement('div');
                    tooltip.className='tooltip';

                    const dot = document.createElement('span');
                    dot.className=`event-dot bg-${entry.type}`;
                    tooltip.appendChild(dot);

                    const ttext = document.createElement('span');
                    ttext.className='tooltiptext';
                    ttext.textContent=`${member.name} (${entry.type})`;
                    tooltip.appendChild(ttext);

                    dotsContainer.appendChild(tooltip);
                });
                dayCell.appendChild(dotsContainer);
            }

            /* highlight today */
            const today = new Date(); today.setHours(0,0,0,0);
            if (dayDate.toDateString() === today.toDateString()) dayCell.classList.add('border-2','border-blue-500');

            calendar.appendChild(dayCell);
        }
    }

    function renderTimeOffSummary() {
        timeOffSummaryBody.innerHTML='';
        const thisYear = new Date().getFullYear();

        teamMembers.forEach(member => {
            let vac=0, sick=0, other=0;
            timeOffEntries.filter(e => e.memberId===member.id && new Date(e.startDate).getFullYear()===thisYear)
                           .forEach(e => {
                               const days = (new Date(e.endDate)-new Date(e.startDate))/(1000*3600*24)+1;
                               if (e.type==='vacation') vac += days;
                               else if (e.type==='sick') sick += days;
                               else other += days;
                           });
            const row = timeOffSummaryBody.insertRow();
            row.innerHTML = `
                <td class="px-6 py-4 font-medium text-gray-900">${member.name}</td>
                <td class="px-6 py-4 text-gray-500">${vac}</td>
                <td class="px-6 py-4 text-gray-500">${sick}</td>
                <td class="px-6 py-4 text-gray-500">${other}</td>
                <td class="px-6 py-4 font-medium text-gray-900">${vac+sick+other}</td>`;
        });
    }

    /* month‑filter dropdown */
    function populateMonthFilter() {
        if (!monthFilterSelect) return;
        const set = new Set();
        timeOffEntries.forEach(e => {
            const d = new Date(e.startDate);
            set.add(`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`);
        });
        const currentValue = monthFilterSelect.value;
        monthFilterSelect.innerHTML = '<option value="all">All Months</option>';
        [...set].sort().forEach(key => {
            const [y,m] = key.split('-');
            const label = `${new Date(y, m-1).toLocaleString('default',{month:'long'})} ${y}`;
            const opt = document.createElement('option');
            opt.value = key; opt.textContent = label;
            monthFilterSelect.appendChild(opt);
        });
        if ([...monthFilterSelect.options].some(o=>o.value===currentValue)) monthFilterSelect.value=currentValue;
    }

    function renderTimeOffOverview() {
        timeOffTableBody.innerHTML='';
        const selected = monthFilterSelect?.value || 'all';
        const list = selected==='all' ? timeOffEntries : timeOffEntries.filter(e => {
            const d = new Date(e.startDate);
            return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}` === selected;
        });

        list.forEach(entry => {
            const member = teamMembers.find(m=>m.id===entry.memberId);
            if (!member) return;
            const s = new Date(entry.startDate);
            const e = new Date(entry.endDate);
            const days = (e - s)/(1000*3600*24)+1;
            const row = timeOffTableBody.insertRow();
            row.innerHTML = `
                <td class="px-6 py-4 font-medium text-gray-900">${member.name}</td>
                <td class="px-6 py-4"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-${entry.type}-100 text-${entry.type}-800">${entry.type}</span></td>
                <td class="px-6 py-4 text-gray-500">${s.toLocaleDateString()} – ${e.toLocaleDateString()}</td>
                <td class="px-6 py-4 text-gray-500">${days} day(s)</td>
                <td class="px-6 py-4 text-gray-500">${entry.notes || '-'}</td>
                <td class="px-6 py-4">
                    <button class="text-red-600 hover:text-red-900 delete-time-off" data-id="${entry.id}">Delete</button>
                </td>`;
        });
        document.querySelectorAll('.delete-time-off').forEach(btn => btn.addEventListener('click', () => deleteTimeOffEntry(btn.dataset.id)));
    }

    function populateMemberDropdown() {
        timeOffMemberSelect.innerHTML = '';
        teamMembers.forEach(m => {
            const opt = document.createElement('option');
            opt.value = m.id; opt.textContent = m.name;
            timeOffMemberSelect.appendChild(opt);
        });
    }

    /* ------------------------------------------------------------------
       API calls (create/delete)
    ------------------------------------------------------------------ */
    async function saveNewMember() {
        const name = memberNameInput.value.trim();
        if (!name) return alert('Please enter a name');
        const res = await fetch('/api/members', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({name})});
        if (!res.ok) return alert('Failed to save member');
        teamMembers.push(await res.json());
        renderAll();
        memberNameInput.value='';
        addMemberModal.classList.add('hidden');
    }

    async function deleteMember(id) {
        if (!confirm('Delete member and all their time‑off entries?')) return;
        const res = await fetch(`/api/members/${id}`, {method:'DELETE'});
        if (!res.ok) return alert('Failed to delete member');
        await fetchData();
        renderAll();
    }

    async function saveTimeOff() {
        const memberId = parseInt(timeOffMemberSelect.value);
        const type     = timeOffTypeSelect.value;
        const start    = timeOffStartInput.value;
        const end      = timeOffEndInput.value;
        if (!memberId || !start || !end) return alert('Please fill in all required fields');
        if (new Date(end) < new Date(start)) return alert('End date cannot be before start date');
        const newEntry = {memberId, type, startDate:start, endDate:end, notes:timeOffNotesInput.value.trim()};
        const res = await fetch('/api/timeoff',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(newEntry)});
        if (!res.ok) return alert('Failed to save');
        timeOffEntries.push(await res.json());
        renderAll();
        timeOffModal.classList.add('hidden');
    }

    async function deleteTimeOffEntry(id) {
        if (!confirm('Delete this time‑off entry?')) return;
        const res = await fetch(`/api/timeoff/${id}`, {method:'DELETE'});
        if (!res.ok) return alert('Failed to delete');
        timeOffEntries = timeOffEntries.filter(e=>e.id!==parseInt(id));
        renderAll();
    }

    /* ------------------------------------------------------------------
       Init + listeners
    ------------------------------------------------------------------ */
    function setupEventListeners() {
        addMemberBtn.addEventListener('click', () => addMemberModal.classList.remove('hidden'));
        closeModalBtn.addEventListener('click', () => addMemberModal.classList.add('hidden'));
        cancelAddMemberBtn.addEventListener('click', () => addMemberModal.classList.add('hidden'));
        saveMemberBtn.addEventListener('click', saveNewMember);

        prevMonthBtn.addEventListener('click', () => {currentDate.setMonth(currentDate.getMonth()-1); renderCalendar();});
        nextMonthBtn.addEventListener('click', () => {currentDate.setMonth(currentDate.getMonth()+1); renderCalendar();});
        todayBtn.addEventListener('click', () => {currentDate = new Date(); renderCalendar();});

        addTimeOffBtn.addEventListener('click', () => timeOffModal.classList.remove('hidden'));
        closeTimeOffModalBtn.addEventListener('click', () => timeOffModal.classList.add('hidden'));
        cancelTimeOffBtn.addEventListener('click', () => timeOffModal.classList.add('hidden'));
        saveTimeOffBtn.addEventListener('click', saveTimeOff);

        monthFilterSelect.addEventListener('change', renderTimeOffOverview);
    }

    async function init() {
        setupEventListeners();
        await fetchData();
        renderAll();
        const today = new Date().toISOString().split('T')[0];
        timeOffStartInput.value = today; timeOffEndInput.value = today;
    }

    function renderAll() {
        renderTeamMembers();
        renderCalendar();
        populateMonthFilter();
        renderTimeOffOverview();
        renderTimeOffSummary();
        populateMemberDropdown();
    }

    document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
